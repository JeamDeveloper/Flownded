<!DOCTYPE html>
<html>
<head>
    <title>Detecci√≥n de Key de Autotune</title>
    <script src="https://cdn.jsdelivr.net/npm/tone@14"></script>
    <script src="https://cdn.jsdelivr.net/npm/tonal@5"></script>
</head>
<body>
    <form id="upload-form">
        <input type="file" id="music-file" accept=".mp3,.wav">
        <button type="button" onclick="detectKey()">Detectar Key</button>
    </form>
    <div id="result"></div>

    <script>
        async function detectKey() {
            const fileInput = document.getElementById('music-file');
            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = async function(event) {
                const arrayBuffer = event.target.result;
                const audioBuffer = await Tone.context.decodeAudioData(arrayBuffer);
                detectKeyUsingTonal(audioBuffer);
            };

            reader.readAsArrayBuffer(file);
        }

        async function detectKeyUsingTonal(audioBuffer) {
            const audioData = [];
            for (let channel = 0; channel < audioBuffer.numberOfChannels; channel++) {
                audioData.push(audioBuffer.getChannelData(channel));
            }

            const key = tonal.key.getKey(audioData, audioBuffer.sampleRate);
            const keyName = tonal.Note.pc(key.mode === 'minor' ? key.tonic + 'm' : key.tonic);

            const resultDiv = document.getElementById('result');
            resultDiv.innerText = `La Key detectada es: ${keyName}`;
        }
    </script>
</body>
</html>
